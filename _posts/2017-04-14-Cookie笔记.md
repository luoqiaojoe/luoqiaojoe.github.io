---
layout: post
author: 罗必才
title: Cookie笔记
category: 理论知识
tag: [理论]
---

#### Cookie 基础知识

+ 从JavaScript的角度看，`cookie` 就是一些字符串信息。这些信息存放在客户端的计算机中，用于客户端计算机与服务器之间传递信息。
+ 可以通过 `document.cookie` 来读取或设置这些信息。
+ 服务端的语言（如PHP）也可以存取 `cookie`。

+ 每个 `cookie` 所存放的数据不能超过4kb，如果超过4kb，则该属性返回空字符串。
+ `cookie`的格式：<cookie名>=<值>；名称和值都必须是合法的标示符。
cookie存在有效期的。在默认情况下，一个 `cookie` 的生命周期就是在浏览器关闭的时候结束。我们也可以为 `cookie`设置有效期，设置有效期后的 `cookie` 将会被保存到硬盘上。
+ `cookie` 有域和路径这个概念。所以不同的域之间是不能互相访问 `cookie` 的。路径就是`routing`的概念，一个网页所创建的 `cookie` 只能被与这个网页在同一目录或子目录下得所有网页访问，而不能被其他目录下得网页访问（这句话有点绕，一会看个例子就好理解了）。
+ 同个网站可以创建多个 `cookie` ，而多个 `cookie` 可以存放在同一个 `cookie` 文件中。
+ `cookie` 存在两种类型：你浏览的当前网站本身设置的 `cookie`；来自在网页上嵌入广告或图片等其他域来源的 第三方 `cookie` (网站可通过使用这些 `cookie` 跟踪你的使用信息)

 
#### Cookie基础用法

##### 一.简单的存取操作

　　在使用JavaScript存取 `cookie` 时，必须要使用Document对象的 `cookie` 属性；一行代码介绍如何创建和修改一个 `cookie` ：

　　`document.cookie  = 'username=Darren'`
　　以上代码中'username'表示 `cookie` 名称，'Darren'表示这个名称对应的值。假设 `cookie` 名称并不存在，那么就是创建一个新的 cookie；如果存在就是修改了这个 `cookie` 名称对应的值。如果要多次创建 `cookie` ，重复使用这个方法即可。

##### 二.cookie的读取操作

　　要精确的对 `cookie` 进行读取其实很简单，就是对字符串进行操作。从w3school上copy这段代码来做分析：

{% highlight c %}
function getCookie(c_name){
　　　　if (document.cookie.length>0){　　//先查询cookie是否为空，为空就return ""
　　　　　　c_start=document.cookie.indexOf(c_name + "=")　　//通过String对象的indexOf()来检查这个cookie是否存在，不存在就为 -1　　
　　　　　　if (c_start!=-1){ 
　　　　　　　　c_start=c_start + c_name.length+1　　//最后这个+1其实就是表示"="号啦，这样就获取到了cookie值的开始位置
　　　　　　　　c_end=document.cookie.indexOf(";",c_start)　　//其实我刚看见indexOf()第二个参数的时候猛然有点晕，后来想起来表示指定的开始索引的位置...这句是为了得到值的结束位置。因为需要考虑是否是最后一项，所以通过";"号是否存在来判断
　　　　　　　　if (c_end==-1) c_end=document.cookie.length　　
　　　　　　　　return unescape(document.cookie.substring(c_start,c_end))　　//通过substring()得到了值。想了解unescape()得先知道escape()是做什么的，都是很重要的基础，想了解的可以搜索下，在文章结尾处也会进行讲解cookie编码细节
　　　　　　} 
　　　　}
　　　　return ""
　　}
{% endhighlight %}

##### 三.设置cookie的有效期

　　`document.cookie = "name=value;expires=date"`
　　上面代码中的date值为GMT(格林威治时间)格式的日期型字符串，生成方式如下：

{% highlight c %}
var _date = new Date();
_date.setDate(_date.getDate()+30);
_date.toGMTString();
{% endhighlight %}

	上面三行代码分解为几步来看：

	+ 通过`new`生成一个`Date`的实例，得到当前的时间；
	+ `getDate()`方法得到当前本地月份中的某一天，接着加上30就是我希望这个`cookie`能过在本地保存30天；
	+ 接着通过`setDate()`方法来设置时间；
	+ 最后用`toGMTString()`方法把`Date`对象转换为字符串，并返回结果

　　通过下面这个完整的函数来说明在创建 `cookie` 的过程中我们需要注意的地方 - 从w3school复制下来的。创建一个在 `cookie` 中存储信息的函数：

{% highlight c %}
1 　function setCookie(c_name, value, expiredays){
2 　　　　var exdate=new Date();
3 　　　　exdate.setDate(exdate.getDate() + expiredays);
4 　　　　document.cookie=c_name+ "=" + escape(value) + ((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
5 　　}
6 　　使用方法：setCookie('username','Darren',30)  
{% endhighlight %}

　　现在我们这个函数是按照天数来设置`cookie`的有效时间，如果想以其他单位（如：小时）来设置，那么改变第三行代码即可：

　　`exdate.setHours(exdate.getHours() + expiredays);`
　　这样设置以后的cookie有效期就是按照小时为单位的。

**注：**服务端语言也可以给`cookie`设置有效期，只是方式不同。


#### Cookie 进阶知识

　　##### 一.cookie 路径概念

　　在基础知识中有提到 `cookie` 有域和路径的概念，现在来介绍路径在 `cookie` 中的作用。

　　`cookie` 一般都是由于用户访问页面而被创建的，可是并不是只有在创建 `cookie` 的页面才可以访问这个 `cookie`。

　　默认情况下，只有与创建`cookie`的页面在同一个目录或子目录下的网页才可以访问，这个是因为安全方面的考虑，造成不是所有页面都可以随意访问其他页面创建的 `cookie`。举个例子：

　　在 `"http://www.cnblogs.com/Darren_code/"` 这个页面创建一个`cookie`，那么在"/Darren_code/"这个路径下的页面如： `"http://www.cnblogs.com/Darren_code/archive/2011/11/07/Cookie.html"`这个页面默认就能取到`cookie`信息。

　　可在默认情况下，"http://www.cnblogs.com"或者 "http://www.cnblogs.com/xxxx/" 就不可以访问这个 `cookie`

　　那么如何让这个 `cookie` 能被其他目录或者父级的目录访问类，通过设置 `cookie` 的路径就可以实现。例子如下：

　　`document.cookie = "name=value;path=path"`
　　`document.cookie = "name=value;expires=date;path=你设置的path"`
 　最常用的例子就是让 `cookie` 在根目录下,这样不管是哪个子页面创建的 `cookie`，所有的页面都可以访问到了:

　　`document.cookie = "name=Darren;path=/"`
　　 

　　##### 二.cookie 域概念

　　路径能解决在同一个域下访问 `cookie` 的问题，咱们接着说 `cookie` 实现同域之间访问的问题。语法如下：

　　`document.cookie = "name=value;path=path;domain=你设置的domain"`

　　例如 `"www.qq.com"` 与 `"sports.qq.com"` 公用一个关联的域名`"qq.com"`，我们如果想让 `"sports.qq.com"` 下的cookie被` "www.qq.com"` 访问，我们就需要用到 `cookie` 的`domain`属性，并且需要把`path`属性设置为 "/"。例：

　　`document.cookie = "username=Darren;path=/;domain=qq.com"`

**注：**一定的是同域之间的访问，不能把`domain`的值设置成非主域的域名。


　　##### 三.cookie 安全性

　　通常 `cookie` 信息都是使用HTTP连接传递数据，这种传递方式很容易被查看，所以 `cookie` 存储的信息容易被窃取。假如 `cookie`中所传递的内容比较重要，那么就要求使用加密的数据传输。

　　所以 `cookie` 的这个属性的名称是“secure”，默认的值为空。如果一个 `cookie`的属性为`secure`，那么它与服务器之间就通过HTTPS或者其它安全协议传递数据。语法如下：

　　document.cookie = "username=Darren;secure"
　　把`cookie`设置为`secure`，只保证 `cookie` 与服务器之间的数据传输过程加密，而保存在本地的 `cookie`文件并不加密。如果想让本地`cookie`也加密，得自己加密数据。

**注：**就算设置了`secure`属性也并不代表他人不能看到你机器本地保存的 `cookie` 信息，所以一般涉及到用户登录注册行为的，肯定不能使用`cookie`


　　##### 四.cookie 编码细节

　　在输入`cookie`信息时不能包含空格，分号，逗号等特殊符号，而在一般情况下，`cookie` 信息的存储都是采用未编码的方式。所以，在设置 `cookie` 信息以前要先使用`escape()`函数将 `cookie` 值信息进行编码，在获取到 `cookie` 值得时候再使用`unescape()`函数把值进行转换回来。如设置`cookie`时：

　　`document.cookie = name + "="+ escape (value)``
　　再看看基础用法时提到过的`getCookie()`内的一句：

　　`return unescape(document.cookie.substring(c_start,c_end))`
　　这样就不用担心因为在cookie值中出现了特殊符号而导致 `cookie` 信息出错了。

文章部分内容出处：http://www.cnblogs.com/Darren_code/